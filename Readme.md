# Falut Assessment for Escalator

## 1.背景

​	这是一个扶梯健康诊断的Demo，用于智慧扶梯系统的扶梯健康诊断模块。

​	针对在城市地铁站中的扶梯，安装上一系列传感器来时时的收集扶梯的数据。这些数据可以**反应这部扶梯当前的工况**，其具体主要包括扶梯各个关键部件的振动加速度、扶梯的负载大小、扶梯关键部件温度、扶梯运行噪声。在**正常扶梯**和有**潜在故障扶梯**（如电机故障、齿轮轴承长期磨损甚至断裂等）上收集到的数据，是有一定差异性的。基于这些数据的差异性，就可以来判断当前扶梯的工况，从而诊断扶梯的健康状况，以保证扶梯的安全运行。

​	扶梯公司本身开发了一套软件配套硬件来支持智慧扶梯系统，其流程如下：

​	扶梯+传感器+现场设备 ——> 传感器数据采集 ——> 数据本地存储 ——> 数据上传云端平台集中 ——> 用于智慧扶梯系统

​	在扶梯安全方面只能实现原始数据的搜集，而我们开发的Demo就是其扶梯健康诊断模块的核心。不仅需要**实现健康诊断功能**，并且要能稳定地**嵌入到其公司原有软件中使用**。

## 2.简介

* Demo功能：实现对扶梯健康状况的诊断。具体包括三个步骤：
  1. 对原始信号数据进行**信号处理**和**特征提取**。
  2. 机器学习算法实现工况判断， **判定扶梯的潜在故障**。
  3. 综合判断给出一个扶梯健康指标。
* Demo任务：分为3个部分，机械部分+算法部分+软开部分。**后两个部分由我完成**，机械部分由我的partner完成。
  * 机械部分：对扶梯工况的判断；利用Ansys和Solidworks等软件实现故障模拟、获取机械仿真数据。
  * 算法部分：基于**Matlab**实现原始信号的信号处理、特征提取算法库、机器学习算法、综合判断算法。
  * 软开部分：基于**C#语言**和**.Net平台**的Demo的开发实现；与公司原有软件进行**联调测试**。

## 3.技术细节

### 1.算法

* 算法的实现：基于Matlab平台，以库函数的形式实现主要算法，留出API，以供Demo中调用。

* 算法库：算法主要基于**信号处理、机械结构和机器学习**三个方面的知识，目前大体分为五部分：
  * 特征提取算法：基于傅里叶变换等算法，实现信号的频域变换，同时提取时域和频域下的数个**典型特征值**。
  * 基频分析算法：基于机械原理和扶梯机械机构，获取扶梯关键部件（如齿轮、链条、轴承等）的振动基频。
  * 谱分析算法：基于信号处理与频域变换，获取谱图数据，用于公司软件的**可视化**。
  * 机器学习算法：基于传统机器学习算法（如SVM分类器，决策树等）实现**对扶梯运行工况的识别和分类**。
  * 综合判断算法：基于机器学习算法的识别结果，结果信号和机械方面的特征提取以及辅助传感器数据，综合判定当前扶梯的健康程度。

### 2.Demo开发

* Demo的开发是基于**.Net平台和C#语言**。开发的要求：1. **模块化编程**，以便二期工程优化升级； 2.**可移植性好**，以便集成到现有软件中。

* Demo任务总体流程：原始数据读入 ——> 数据处理 ——> 调用算法（算法调用次序参见第2节简介） ——> 输出健康指标+请求数据
* Demo开发难点：在.Net平台的C#编程中对Matlab算法的调用。解决这一难点的思路是思路是**C#和Matlab的混合编程**。

Demo任务流程：数据读入、封装方法、算法库、封装方法

### 3.C#与Matlab的混合编程

* C#与Matlab的混合编程的主要思路：**移植+封装**
* **移植**：将Matlab中实现的算法库移植到.Net平台。
  1. 在Matlab中**以库函数**的形式实现核心算法。
  2. 借助Matlab-deploytool工具箱子，将核心算法转为**动态链接库**。
  3. 配置环境，在.Net平台中调试与调用。
* **封装**：对核心算法、数据处理、调用核心算法等进行封装，留出指定接口。其目的一是为了模块化编程，方便二次开发；二是为了解决**数据类型转换的问题**。
  * C#数据类型是常见的int、float、string等；核心算法接口所需数据类型：MW。一种**基于Matlab解释器**的数据类型，有各种子类，囊括了**结构体、数组和多维矩阵**等数据。
  * 转换方法：Matlab有相应的数据转换方法，已经集成为**动态链接库形式**，只需嵌入demo，即可**调用相应库**进行两种数据的相互转换。
  * Demo中数据类型变化流程概述：---（数据输入）---> **C#数据类型** ---（处理和封装）---> **MW数据类型** ---（调用核心算法）---> **MW数据类型**  ---（封装和处理）---> **C#数据类型** ---（数据输出）---> 

### 4.其他

* 环境配置：公司原软件运行在工控机上Windows环境下，Demo要从现有的装有Matlab的环境中迁移过去（要脱落Matlab软件，对于公司使用会收费）。
  * 解决方法：使用免费的MCR（Matlab Complier Runtime）实现对核心算法的编译运行。
  * 最终运行环境环境：Windows + MCR + .Net + Demo
* 调试：主要包括两块，1. 开发移植中的调试；2. 集成到原软件的联调。解决移植Bug和环境错误，目的主要是为了将整套开发流程摸索清楚，方便后续项目和二次开发。
* 文档：撰写相应文档，记录整个Demo的开发、移植、使用。

## 4.项目展示

* 项目整体展示

  ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E9%A1%B9%E7%9B%AE%E5%B1%95%E7%A4%BA.png">
  </div>
  ```

* Demo部分方法封装接口展示

   ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E9%83%A8%E5%88%86%E5%B0%81%E8%A3%85%E6%8E%A5%E5%8F%A3%E5%B1%95%E7%A4%BA.png">
  </div>
  ```

* 前期算法移植测试对比

 ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E7%AE%97%E6%B3%95%E7%A7%BB%E6%A4%8D%E6%B5%8B%E8%AF%95%E5%AF%B9%E6%AF%94.png">
  </div>
 ```

* 前期机器学习算法测试结果

 ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95%E6%B5%8B%E8%AF%95.png">
  </div>
 ```

* Demo嵌入智慧扶梯系统软件联调测试-1

 ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95.png">
  </div>
 ```

* Demo嵌入智慧扶梯系统软件联调测试-2
 ```html
  <div align=center>
  <img src="https://github.com/Fantasty9413/Failure-Analysis-of-Escalator/blob/main/Image/%E8%81%94%E8%B0%83%E8%BF%90%E8%A1%8C.jpg">
  </div>
 ```

